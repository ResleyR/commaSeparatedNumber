function commaSeparatedNumber(e){for(var t=[],a=0;a<arguments.length-1;a++)t[a]=arguments[a+1];return Array.prototype.reduce.call(this,function(t,a){return $this=$(a),existingData=$this.data("comma-separated-number"),data=existingData||new CommaSeparatedNumber(a,e),existingData?data.updateOptions(e):$this.data("comma-separated-number",data),"string"==typeof e?data[e]():t},this)}var CommaSeparatedNumber=function(){function e(e,t){void 0===t&&(t={});var a=this;this.defaults={allowedChars:"bmk",allowDecimal:!0,allowNegative:!0,maxDecimals:null,distanceBetweenCommas:3},this.element=e,this.updateOptions(t),this.element.addEventListener("keypress",function(e){return a.validateInput(e)}),this.element.addEventListener("paste",function(e){return a.validateInput(e)}),this.element.addEventListener("input",function(e){return a.cleanInput(e)}),this.cleanInput()}return e.prototype.updateOptions=function(e){this.options=$.extend(this.options,this.defaults,e);var t="[^\\d"+this.options.allowedChars;this.options.allowDecimal&&(t+="."),this.options.allowNegative&&(t+="-"),t+="]",this.regex=new RegExp(t,"i"),t="\\B(?=(\\d{"+this.options.distanceBetweenCommas+"})+(?!\\d))",this.commaRegex=new RegExp(t,"g"),t="(-?\\d+(?:\\.\\d{"+this.options.maxDecimals+"}))\\d*",this.maxDecimalsRegex=new RegExp(t)},e.prototype.validateInput=function(e){var t="keypress"===e.type?String.fromCharCode(e.keyCode||e.which):e.originalEvent.clipboardData.getData("Text");this.isInputInvalid(t)&&(e.preventDefault(),e.stopImmediatePropagation())},e.prototype.isInputInvalid=function(e){if(this.regex.test(e))return!0;switch(e){case".":return this.causesMultipleDecimals();case"-":return!this.isValidNegativeSign();default:return!1}},e.prototype.causesMultipleDecimals=function(){return/.*\..*\..*/.test($(this.element).val()+".")},e.prototype.isValidNegativeSign=function(){return 0===this.element.selectionStart&&"-"!==this.element.value.substr(0,1)},e.prototype.cleanInput=function(){var e=this.element.selectionStart,t=this.element.selectionEnd,a=this.element.value,i=a.length;a=a.replace(/,/,"").replace(/b/gi,"mk").replace(/m/gi,"kk").replace(/k/gi,"000"),this.options.allowDecimal&&null!==this.options.maxDecimals&&(a=a.replace(this.maxDecimalsRegex,"$1")),this.element.setAttribute("data-value",a);var n=(a=a.replace(this.commaRegex,",")).length-i;this.element.value=a,this.element.setSelectionRange(e+n,t+n)},e}();$.fn.commaSeparatedNumber=commaSeparatedNumber,$.fn.commaSeparatedNumber.Constructor=CommaSeparatedNumber,$(function(){$("input").commaSeparatedNumber({maxDecimals:4}),$("button").on("click",function(){console.log($("input").data("value"))})});